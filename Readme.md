The API is built using the **Slim Framework**, follows a **RESTful** pattern, and requires **Firebase Authentication** for all requests via the `FirebaseAuthMiddleware`.

---

## Base API Configuration

* **Base URL:** `https://track.navitag.com/v1`
* **Auth Header:** `Authorization: Bearer <firebase_id_token>`
* **Content-Type:** `application/json`

---

## 1. User Management

### Sync User Account

Synchronizes the Firebase user with the local MySQL database and the specified Traccar server.

* **Endpoint:** `POST /user/sync`
* **Parameters:**
* `country_code` (string, required): to get the traccar server domain if creating a new user.
* `name` (string, optional): Display name for the user.
* `phone` (string, optional): Contact number.


* **Logic:** Creates a new Traccar/DB record if it doesn't exist; otherwise, refreshes existing data.

### Update FCM Token

Saves or updates the Firebase Cloud Messaging token for push notifications.

* **Endpoint:** `POST /user/fcm-token`
* **Parameters:**
* `fcm_token` (string, required): The unique token generated by the mobile app.



### Update User Profile

* **Endpoint:** `POST /user/update`
* **Parameters:**
* `id` (int): Internal MySQL ID.
* `server_id` (int): Traccar User ID.
* `server_url` (string): Target Traccar instance.
* `name` (string): New display name.
* `mobile` (string): New phone number.



---

## 2. Device & Inventory Management

### Create Inventory Record (Admin Only)

Registers a new physical device into the system.

* **Endpoint:** `POST /inventory/createRecord`
* **Parameters:**
* `server_url` (string): Traccar instance to host the device.
* `imei` (string): Device unique 15-digit ID.
* `iccid` (string): SIM card ID.


* **Logic:** Validates SIM status in Simbase, creates the device in Traccar, and logs the entry in MySQL.

### Link Device to User

Assigns a device from the inventory to the authenticated user.

* **Endpoint:** `POST /user/link-device`
* **Parameters:**
* `imei` (string): The device IMEI.
* `name` (string): The custom name the user wants to give the tracker.



### Enable/Activate Device

Activates the SIM card via Simbase and calculates the initial expiration date.

* **Endpoint:** `POST /device/enable`
* **Parameters:**
* `imei` (string): Target device IMEI.



### Disable Device

Deactivates the SIM card to prevent data usage.

* **Endpoint:** `POST /device/disable`
* **Parameters:**
* `imei` (string): Target device IMEI.



---

## 3. Server & Tracking Data

### Get Tracking History

Retrieves historical GPS coordinates for a specific date.

* **Endpoint:** `POST /history/positions`
* **Parameters:**
* `imei` (string): Device IMEI.
* `date` (string): Date in `YYYY-MM-DD` format.
* `timezone` (string): User's local timezone (e.g., `Asia/Manila`).



### Service Health Check

Checks the connectivity of MySQL, Traccar, and Simbase.

* **Endpoint:** `GET /server/test` or `POST /server/status`
* **Parameters (POST only):**
* `server_url` (string, optional): Specific server to check.



### Generate Traccar Token

Generates a session token for direct Traccar API/Frontend access.

* **Endpoint:** `POST /server/token`
* **Parameters:**
* `server_url` (string): Target Traccar instance.



---

## 4. Notifications

### Send Push Notification (Admin Only)

* **Endpoint:** `POST /notification/send`
* **Parameters:**
* `token` (string): Target device FCM token.
* `title` (string): Notification title.
* `body` (string): Notification message.
* `data` (object, optional): Key-value pairs for deep linking.
